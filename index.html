<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home Automation Portal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 1rem 2rem;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2rem;
            font-weight: 300;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1.5rem;
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .widget {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .widget:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .widget h2 {
            color: #2c3e50;
            margin-bottom: 1rem;
            font-size: 1.3rem;
            font-weight: 500;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .login-form input {
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .login-form input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-danger {
... (653 lines left)
Collapse
homeautomation.html
26 KB
jkust improve it a little bit
starbolt8980 — 6/6/2025 7:37 PM
sure will test it in a bit
HEHE — 6/8/2025 5:14 PM
yow how's the other group member
have u contacted him 
starbolt8980 — 6/9/2025 1:20 AM
Nah he's not responding

His snap is lil_faffi but I doubt he'll reply
I can get a special consideration for about 2-3days extra so I'll check tmrw

also did u push ur changes? as i cant see anything on github 
HEHE — 6/9/2025 5:25 AM
nah I didn't
HEHE — 6/9/2025 12:42 PM
Did u add anything
U can change it a bit
starbolt8980 — 6/17/2025 7:49 PM
hey sorry for late response, yeah im going to fix up the login, as each error stacks on
also were u able to login using the provided logins?

also just an update we got an extension til the 20th
starbolt8980 — 6/19/2025 12:49 AM
heres my code that i fixed for the error message:
  } else {
                    //Stops message from stacking repeatedly
                    const repeatError = document.querySelector('#login-content .error');
                    if (repeatError)repeatError.remove(); existi
                    
                    document.getElementById('login-content').innerHTML += '<div class="error">Login failed. Please check your credentials.</div>';
                }
. 


also took me forever to find out why login wasnt working ahaha but the issue was in line 370 you had auth/login instead of user
so change that to 
          const response = await fetch(`${BASE_URL}/users/login`, {
 

only issue now i can see api call function failed in the console log so i'll work in the morning hopefully but proably another issue with some wording



pre much finished now btw, fixed all errors, now they display properly, login works, etc. doing the report now if you could answer these questions and i'll add them together: Details of your deployment and where your application can be accessed (URL).
What you achieved: a short (few paragraphs) description of what your group has implemented; highlight any extensions or additional work you did.
What did you find challenging: tell us what was hard about completing the project. This might be technical (understanding the API) or organisational (communication within the group). 
What was rewarding: one or two things that you were able to do that you feel contributed to your understanding of the content of this unit 
﻿
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home Automation Portal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 1rem 2rem;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2rem;
            font-weight: 300;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1.5rem;
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .widget {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .widget:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .widget h2 {
            color: #2c3e50;
            margin-bottom: 1rem;
            font-size: 1.3rem;
            font-weight: 500;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .login-form input {
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .login-form input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #51cf66 0%, #40c057 100%);
        }

        .device-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin: 0.5rem 0;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: #ccc;
            border-radius: 15px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .toggle-switch.on {
            background: #4caf50;
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
        }

        .toggle-switch.on::after {
            transform: translateX(30px);
        }

        .sensor-reading {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid #eee;
        }

        .sensor-value {
            font-weight: bold;
            color: #667eea;
        }

        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid #eee;
        }

        .list-item:last-child {
            border-bottom: none;
        }

        .delete-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.25rem 0.5rem;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .add-item-form {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .add-item-form input {
            flex: 1;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .weather-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .weather-card {
            text-align: center;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .temperature {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }

        .status-on {
            background: #4caf50;
        }

        .status-off {
            background: #f44336;
        }

        .ad-content {
            text-align: center;
            padding: 2rem;
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
            border-radius: 10px;
            color: #2d3436;
        }

        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
        }

        .error {
            color: #f44336;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
                padding: 1rem;
            }
            
            .header {
                padding: 1rem;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🏠 Home Automation Portal</h1>
    </div>

    <div class="dashboard">
        <!-- Login Widget -->
        <div class="widget" id="login-widget">
            <h2>🔐 Authentication</h2>
            <div id="login-content">
                <div class="login-form">
                    <input type="text" id="username" placeholder="Username" />
                    <input type="password" id="password" placeholder="Password" />
                    <button class="btn" onclick="login()">Login</button>
                </div>
            </div>
        </div>

        <!-- Device Controller Widget -->
        <div class="widget" id="device-widget">
            <h2>💡 Device Controller</h2>
            <div id="device-content">
                <div class="loading">Loading devices...</div>
            </div>
        </div>

        <!-- Sensor Display Widget -->
        <div class="widget" id="sensor-widget">
            <h2>🌡️ Sensor Monitor</h2>
            <div id="sensor-content">
                <div class="loading">Loading sensors...</div>
            </div>
        </div>

        <!-- Weather Widget -->
        <div class="widget" id="weather-widget">
            <h2>🌤️ Weather Information</h2>
            <div id="weather-content">
                <div class="loading">Loading weather data...</div>
            </div>
        </div>

        <!-- Shopping List Widget -->
        <div class="widget" id="shopping-widget">
            <h2>🛒 Shopping List</h2>
            <div id="shopping-content">
                <div class="loading">Loading shopping list...</div>
            </div>
        </div>

        <!-- TODO List Widget -->
        <div class="widget" id="todo-widget">
            <h2>✅ TODO List</h2>
            <div id="todo-content">
                <div class="loading">Loading tasks...</div>
            </div>
        </div>

        <!-- Advertisement Widget -->
        <div class="widget" id="ad-widget">
            <h2>📢 Sponsored Content</h2>
            <div class="ad-content">
                <h3>Smart Home Solutions</h3>
                <p>Upgrade your home with the latest IoT devices!</p>
                <p>Visit our store for exclusive deals on smart lighting, security systems, and more.</p>
            </div>
        </div>
    </div>

    <script>
        const BASE_URL = 'https://comp2110-portal-server.fly.dev';
        let currentUser = null;
        let authToken = null;

        // Authentication functions
        function loadUserFromStorage() {
            const userData = localStorage.getItem('homePortalUser');
            const tokenData = localStorage.getItem('homePortalToken');
            if (userData && tokenData) {
                currentUser = JSON.parse(userData);
                authToken = tokenData;
                updateLoginWidget();
                loadDashboardData();
            }
        }

        async function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (!username || !password) {
                alert('Please enter both username and password');
                return;
            }

            try {
                const response = await fetch(`${BASE_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });

                if (response.ok) {
                    const data = await response.json();
                    currentUser = { username };
                    authToken = data.token || 'mock-token';
                    
                    localStorage.setItem('homePortalUser', JSON.stringify(currentUser));
                    localStorage.setItem('homePortalToken', authToken);
                    
                    updateLoginWidget();
                    loadDashboardData();
                } else {
                    document.getElementById('login-content').innerHTML += '<div class="error">Login failed. Please check your credentials.</div>';
                }
            } catch (error) {
                console.error('Login error:', error);
                document.getElementById('login-content').innerHTML += '<div class="error">Network error. Please try again.</div>';
            }
        }

        function logout() {
            currentUser = null;
            authToken = null;
            localStorage.removeItem('homePortalUser');
            localStorage.removeItem('homePortalToken');
            updateLoginWidget();
            clearDashboardData();
        }

        function updateLoginWidget() {
            const loginContent = document.getElementById('login-content');
            if (currentUser) {
                loginContent.innerHTML = `
                    <div class="user-info">
                        <span>Welcome, ${currentUser.username}!</span>
                        <button class="btn btn-danger" onclick="logout()">Logout</button>
                    </div>
                `;
            } else {
                loginContent.innerHTML = `
                    <div class="login-form">
                        <input type="text" id="username" placeholder="Username" />
                        <input type="password" id="password" placeholder="Password" />
                        <button class="btn" onclick="login()">Login</button>
                    </div>
                `;
            }
        }

        // API helper function
        async function apiCall(endpoint, options = {}) {
            const headers = {
                'Content-Type': 'application/json',
                ...options.headers
            };
            
            if (authToken) {
                headers['Authorization'] = `Bearer ${authToken}`;
            }

            try {
                const response = await fetch(`${BASE_URL}${endpoint}`, {
                    ...options,
                    headers
                });
                
                if (response.ok) {
                    return await response.json();
                } else {
                    throw new Error(`API call failed: ${response.status}`);
                }
            } catch (error) {
                console.error(`API call to ${endpoint} failed:`, error);
                return null;
            }
        }

        // Device functions
        async function loadDevices() {
            if (!currentUser) return;
            
            const devices = await apiCall('/devices');
            const deviceContent = document.getElementById('device-content');
            
            if (!devices || devices.length === 0) {
                deviceContent.innerHTML = '<p>No devices found. Please check your connection.</p>';
                return;
            }

            let html = '';
            devices.forEach(device => {
                const statusClass = device.status === 'on' ? 'on' : '';
                html += `
                    <div class="device-controls">
                        <span class="status-indicator ${device.status === 'on' ? 'status-on' : 'status-off'}"></span>
                        <strong>${device.label}</strong>
                        <div class="toggle-switch ${statusClass}" onclick="toggleDevice(${device.id}, '${device.status}')"></div>
                    </div>
                `;
            });
            
            deviceContent.innerHTML = html;
        }

        async function toggleDevice(deviceId, currentStatus) {
            const newStatus = currentStatus === 'on' ? 'off' : 'on';
            
            const result = await apiCall(`/devices/${deviceId}`, {
                method: 'PUT',
                body: JSON.stringify({
                    status: newStatus,
                    properties: {}
                })
            });
            
            if (result) {
                loadDevices(); // Reload to show updated status
            }
        }

        // Sensor functions
        async function loadSensors() {
            if (!currentUser) return;
            
            const sensors = await apiCall('/sensors');
            const sensorContent = document.getElementById('sensor-content');
            
            if (!sensors || sensors.length === 0) {
                sensorContent.innerHTML = '<p>No sensors found. Please check your connection.</p>';
                return;
            }

            let html = '';
            sensors.forEach(sensor => {
                if (sensor.data && sensor.data.length > 0) {
                    const latestData = sensor.data[0].data;
                    html += `
                        <div class="sensor-reading">
                            <span><strong>${sensor.label}</strong></span>
                            <div>
                    `;
                    
                    Object.entries(latestData).forEach(([key, value]) => {
                        if (key !== 'timestamp') {
                            html += `<div class="sensor-value">${key}: ${typeof value === 'number' ? value.toFixed(1) : value}</div>`;
                        }
                    });
                    
                    html += `
                            </div>
                        </div>
                    `;
                }
            });
            
            sensorContent.innerHTML = html || '<p>No sensor data available.</p>';
        }

        // Weather functions
        async function loadWeather() {
            try {
                // Using Open-Meteo API for weather data
                const response = await fetch('https://api.open-meteo.com/v1/forecast?latitude=-33.8688&longitude=151.2093&current_weather=true&hourly=temperature_2m,relative_humidity_2m');
                const data = await response.json();
                
                const weatherContent = document.getElementById('weather-content');
                weatherContent.innerHTML = `
                    <div class="weather-info">
                        <div class="weather-card">
                            <div class="temperature">${data.current_weather.temperature}°C</div>
                            <div>Current Temp</div>
                        </div>
                        <div class="weather-card">
                            <div class="temperature">${data.current_weather.windspeed}</div>
                            <div>Wind Speed (km/h)</div>
                        </div>
                        <div class="weather-card">
                            <div class="temperature">${data.hourly.relative_humidity_2m[0]}%</div>
                            <div>Humidity</div>
                        </div>
                    </div>
                `;
            } catch (error) {
                document.getElementById('weather-content').innerHTML = '<p>Weather data unavailable.</p>';
            }
        }

        // Shopping list functions
        let shoppingListId = null;

        async function loadShoppingList() {
            if (!currentUser) return;
            
            // First, get or create a shopping list
            const lists = await apiCall('/lists');
            let shoppingList = lists?.find(list => list.title === 'Shopping List');
            
            if (!shoppingList) {
                shoppingList = await apiCall('/lists', {
                    method: 'POST',
                    body: JSON.stringify({ title: 'Shopping List' })
                });
            }
            
            if (shoppingList) {
                shoppingListId = shoppingList.id;
                const listData = await apiCall(`/lists/${shoppingListId}`);
                
                const shoppingContent = document.getElementById('shopping-content');
                let html = '';
                
                if (listData && listData.contents) {
                    listData.contents.forEach(item => {
                        html += `
                            <div class="list-item">
                                <span>${item.content}</span>
                                <button class="delete-btn" onclick="removeShoppingItem(${item.id})">Remove</button>
                            </div>
                        `;
                    });
                }
                
                html += `
                    <div class="add-item-form">
                        <input type="text" id="shopping-input" placeholder="Add item..." />
                        <button class="btn" onclick="addShoppingItem()">Add</button>
                    </div>
                `;
                
                shoppingContent.innerHTML = html;
            }
        }

        async function addShoppingItem() {
            const input = document.getElementById('shopping-input');
            const content = input.value.trim();
            
            if (content && shoppingListId) {
                const result = await apiCall(`/lists/${shoppingListId}`, {
                    method: 'POST',
                    body: JSON.stringify({ content })
                });
                
                if (result) {
                    input.value = '';
                    loadShoppingList();
                }
            }
        }

        async function removeShoppingItem(itemId) {
            if (shoppingListId) {
                const result = await apiCall(`/lists/${shoppingListId}/${itemId}`, {
                    method: 'DELETE'
                });
                
                if (result) {
                    loadShoppingList();
                }
            }
        }

        // TODO list functions
        async function loadTasks() {
            if (!currentUser) return;
            
            const tasks = await apiCall('/tasks');
            const todoContent = document.getElementById('todo-content');
            
            let html = '';
            if (tasks && tasks.length > 0) {
                tasks.forEach(task => {
                    const isCompleted = task.category === 'Complete';
                    html += `
                        <div class="list-item">
                            <div>
                                <strong>${task.summary}</strong>
                                ${task.text ? `<div style="font-size: 0.9em; color: #666;">${task.text}</div>` : ''}
                            </div>
                            <div>
                                <button class="btn btn-success" onclick="toggleTask(${task.id}, '${isCompleted ? 'ToDo' : 'Complete'}')">${isCompleted ? 'Undo' : 'Complete'}</button>
                                <button class="delete-btn" onclick="deleteTask(${task.id})">Delete</button>
                            </div>
                        </div>
                    `;
                });
            }
            
            html += `
                <div class="add-item-form">
                    <input type="text" id="task-input" placeholder="Add task..." />
                    <button class="btn" onclick="addTask()">Add Task</button>
                </div>
            `;
            
            todoContent.innerHTML = html;
        }

        async function addTask() {
            const input = document.getElementById('task-input');
            const summary = input.value.trim();
            
            if (summary) {
                const result = await apiCall('/tasks', {
                    method: 'POST',
                    body: JSON.stringify({
                        summary,
                        text: '',
                        priority: 1,
                        category: 'ToDo',
                        due: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString()
                    })
                });
                
                if (result) {
                    input.value = '';
                    loadTasks();
                }
            }
        }

        async function toggleTask(taskId, newCategory) {
            const result = await apiCall(`/tasks/${taskId}`, {
                method: 'PUT',
                body: JSON.stringify({ category: newCategory })
            });
            
            if (result) {
                loadTasks();
            }
        }

        async function deleteTask(taskId) {
            const result = await apiCall(`/tasks/${taskId}`, {
                method: 'DELETE'
            });
            
            if (result) {
                loadTasks();
            }
        }

        // Dashboard management
        function loadDashboardData() {
            if (currentUser) {
                loadDevices();
                loadSensors();
                loadShoppingList();
                loadTasks();
            }
        }

        function clearDashboardData() {
            document.getElementById('device-content').innerHTML = '<div class="loading">Please log in to view devices</div>';
            document.getElementById('sensor-content').innerHTML = '<div class="loading">Please log in to view sensors</div>';
            document.getElementById('shopping-content').innerHTML = '<div class="loading">Please log in to view shopping list</div>';
            document.getElementById('todo-content').innerHTML = '<div class="loading">Please log in to view tasks</div>';
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            loadUserFromStorage();
            loadWeather(); // Weather can load without authentication
            
            // Add enter key support for login
            document.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !currentUser) {
                    const activeElement = document.activeElement;
                    if (activeElement.id === 'username' || activeElement.id === 'password') {
                        login();
                    }
                }
            });
        });
    </script>
</body>
</html>
